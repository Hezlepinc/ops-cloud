services:
  - type: web
    name: ops-orchestrator
    env: node
    plan: starter
    region: oregon
    rootDir: orchestrator
    buildCommand: 'npm install'
    startCommand: 'node src/index.js'
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: PORT
        value: 3000
      # Secrets are stored in Render dashboard; this group is referenced here
      - fromGroup: orchestrator-common
  - type: web
    name: ops-dashboard
    env: node
    plan: starter
    region: oregon
    rootDir: dashboard
    buildCommand: 'npm install && npm run build && npm run export'
    startCommand: 'npx serve -s out -l $PORT'
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: NPM_CONFIG_PRODUCTION
        value: 'false'

envVarGroups:
  - name: orchestrator-common
    envVars:
      # Cloudways API
      - key: CW_EMAIL
        sync: false
      - key: CW_API_KEY
        sync: false
      # Orchestrator auth for /ai/* routes
      - key: OPENAI_API_KEY
        sync: false
      # GitHub status (optional but used by /ai/status in this repo)
      - key: GITHUB_REPO
        sync: false
      - key: GITHUB_TOKEN
        sync: false
      # Optional: add other keys as needed
